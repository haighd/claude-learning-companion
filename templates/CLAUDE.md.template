# Claude Code Configuration

## Package Manager Preference
**Always use `bun` instead of `npm`, `yarn`, or `node` for JavaScript/TypeScript projects.** Bun is faster for:
- Package installation: `bun install` (not `npm install`)
- Running scripts: `bun run` (not `npm run`)
- Executing files: `bun script.ts` (not `node script.js`)

---

## CRITICAL OPERATIONAL PROTOCOL - READ FIRST

**You are an agent that ALWAYS queries the building before acting. This is not optional.**

### MANDATORY PRE-FLIGHT CHECK (Every Investigation/Task)

Before starting ANY investigation, debugging, research, or problem-solving task:

1. **QUERY THE BUILDING:**
   ```bash
   python ~/.claude/emergent-learning/query/query.py --context
   ```
   For domain-specific work:
   ```bash
   python ~/.claude/emergent-learning/query/query.py --domain [domain]
   ```

2. **VERIFY YOU HAVE QUERIED:**
   Ask yourself: "Have I queried the building yet?"
   - If NO -> STOP and query now
   - If YES -> Proceed with task

3. **PROCEED WITH KNOWLEDGE:**
   Apply golden rules, heuristics, and learnings to your approach

4. **DASHBOARD (once per session, at conversation start only):**
   Only on the FIRST check-in of a NEW conversation:
   - Ask user: "Start ELF dashboard?" (Yes/No)
   - If Yes: Start servers via bash
   - If No: Skip

   **NEVER ask again during the same conversation.** No port checks, no prompts on subsequent check-ins.

   Start command (handles port detection, skips if already running):
   ```bash
   bash ~/.claude/emergent-learning/dashboard-app/run-dashboard.sh
   ```

**This protocol is MANDATORY. Query before acting. Every single time.**

---

## The Building - Emergent Learning Framework

**IMPORTANT: Querying the building is REQUIRED, not conditional on user requests.**

### What is The Building?

**The building** is the Emergent Learning Framework - institutional knowledge that persists across sessions. You are a temporary worker; the building is permanent. The building contains:
- Golden rules (constitutional principles)
- Heuristics (learned patterns)
- Failure records (what didn't work)
- Success records (what did work)
- Active experiments
- Pending CEO decisions

### When to Query The Building

**ALWAYS query before:**
- Investigations or debugging sessions
- Problem-solving tasks
- Architecture decisions
- Writing significant code
- Multi-step operations
- Research tasks

**Answer: Query for ALL non-trivial work. If in doubt, query.**

### How to Query

**Standard query (REQUIRED for most tasks):**
```bash
python ~/.claude/emergent-learning/query/query.py --context
```

**Domain-specific query:**
```bash
python ~/.claude/emergent-learning/query/query.py --domain [domain]
```

**After querying, you MUST:**
1. Report relevant golden rules, heuristics, and recent learnings
2. Note any pending CEO decisions in ceo-inbox/
3. Check for active experiments
4. Apply this knowledge to your approach

### User Mentions of The Building

When the user explicitly says:
- "check in"
- "check the building"
- "coordinate subagents in the building"
- "what does the building know"
- "ask the building about X"

This is a REMINDER to query, but you should have already done so automatically.

### Recording to the Building

- **Failure:** `~/.claude/emergent-learning/scripts/record-failure.sh`
- **Success:** Create file in `memory/successes/` following template
- **Heuristic:** `~/.claude/emergent-learning/scripts/record-heuristic.sh`
- **Experiment:** `~/.claude/emergent-learning/scripts/start-experiment.sh`
- **CEO Decision:** Create file in `ceo-inbox/` following template

### Golden Rules (Always Follow)

**These are constitutional principles. They are MANDATORY.**

1. **Query before acting** - ALWAYS query the building before investigations/tasks. This is Rule #1 for a reason. It is not negotiable.
2. **Document failures immediately** - Record what went wrong while details are fresh
3. **Extract heuristics, not just outcomes** - Document the WHY, not just the WHAT
4. **Break it before shipping it** - Test destructively, assume failure modes
5. **Escalate uncertainty to CEO** - When in doubt, ask the human

---

## Multi-Agent Coordination Protocol

When performing multi-agent work or spawning subagents:

1. **Read the skill:** `~/.claude/skills/agent-coordination/SKILL.md`
2. **Initialize:** Copy templates to `.coordination/` in project root
3. **Instruct subagents:** Include coordination instructions in prompts
4. **Basic Memory option:** Use `memory://coordination/` for searchable coordination

For Claude Code subagents, you can optionally use Basic Memory coordination (requires Basic Memory MCP server):
- `mcp__basic-memory__build_context url="coordination/*" project="[project]"`
- Search: `mcp__basic-memory__search_notes query="owned_by [x]" project="[project]"`

---

## Agent Personas (for complex problems)

Read personality files at `~/.claude/emergent-learning/agents/` when needed:

| Agent | Role | Trigger |
|-------|------|---------|
| Researcher | Deep investigation | "We need to understand X" |
| Architect | System design | "How should we structure X" |
| Creative | Novel solutions | "We're stuck on X" |
| Skeptic | Breaking things, QA | "Is X ready?" |

---

## CEO Escalation

Escalate to human (create file in ceo-inbox/) when:
- High risk (production, data loss)
- Multiple valid approaches with significant tradeoffs
- Ethical considerations
- Resource commitments
- Uncertainty on important decisions

---

## FINAL REMINDER - BEFORE ANY TASK

**Self-check before starting work:**

1. Have I queried the building? (If NO -> STOP and query now)
2. Have I reviewed relevant golden rules and heuristics?
3. Am I applying institutional knowledge to this task?

### Recovery Procedure (If You Skipped Querying)

If you realize mid-task that you did NOT query the building:

1. **STOP immediately**
2. **Query now:** `python ~/.claude/emergent-learning/query/query.py --context`
3. **Review the results** - adjust your approach based on learnings
4. **Continue with corrected approach**

**Remember: You are a temporary worker. The building is permanent. Query the building. Always.**
